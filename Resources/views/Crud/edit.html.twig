{# src/IServ/CrudBundle/Resources/views/Crud/edit.html.twig #}
{% extends admin.template('crud_base') %}

{% block content %}

    <div class="row">
        <div class="col-md-12">
            {% block crud_title %}<h1>{{ __('Edit %s', itemTitle) }}</h1>{% endblock crud_title %}
        </div>
    </div>

    <div class="row" role="tabpanel">
        <div class="col-md-12">

            <!-- Nav tabs -->
            <ul class="nav nav-tabs nav-sticky-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#settings" aria-controls="settings" role="tab" data-toggle="tab">{{ _('Settings') }}</a></li>
                <li role="presentation"><a href="#files" aria-controls="files" role="tab" data-toggle="tab">{{ _('Files') }}</a></li>
            </ul>

            <!-- Tab panes -->
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane fade in active pt" id="settings">
                            <div id="crud-form">
                                {{ form(form) }}
                            </div>
                        </div>
                        <div role="tabpanel" class="tab-pane fade pt" id="files">
                            <div class="col-md-12 clearfix" ng-controller="ExerciseAttachmentController as Ctrl">
                                <h4>{{ _('Your attached files') }}</h4>
                                {% if item.attachments is not empty %}
                                    {{ form_start(deleteForm) }}
                                {% endif %}
                                <table class="table table-striped table-hover" id="exerciseAttachments">
                                    <colgroup>
                                        <col/>
                                        <col width="50%"/>
                                        <col width="50%"/>
                                        <col/>
                                    </colgroup>
                                    <thead>
                                    <tr>
                                        <th>{% if item.attachments is not empty %}
                                                <div ng-attr-check-all></div>{% endif %}</th>
                                        <th>{{ _('File') }}</th>
                                        <th>{{ _('Description') }}</th>
                                        <th></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for attachment in item.attachments|isort('name') %}
                                        <tr>
                                            <td class="text-center">{{ form_widget(deleteForm.elements[attachment.id], {'attr': {'class': 'batch'}}) }}</td>
                                            <td><label for="iserv_exercise_attachment_{{ attachment.id }}">{{ fileIcon(attachment.file) }}{{ attachment.file }}</label>
                                                <span class="text-muted">({{ attachment.file.size|size }})</span></td>
                                            <td>
                                                <a href="#editDescription" ng-attr-editable data-type="text" data-pk="{{ attachment.id }}" data-url="{{ path('exercise_attachment_update') }}" data-title="{{ _("Description (optional)") }}" data-name="description" data-emptytext="{{ _('none') }}" title="{{ _('Click to edit description') }}">{{ attachment.description }}</a>
                                            </td>
                                            <td>
                                                <a href="{{ path('exercise_file', {'id': attachment.file.id}) }}" class="btn btn-link btn-icon" title="{{ _('Download file') }}">{{ icon('download') }}</a>
                                            </td>
                                        </tr>
                                    {% else %}
                                        <tr>
                                            <td colspan="4" class="text-center"><em>{{ _('No files are attached yet!') }}</em></td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                    {% if item.attachments is not empty %}
                                        <tfoot class="table-action-footer">
                                        <tr>
                                            <td colspan="4">
                                                {{ form_widget(deleteForm.actions) }}
                                            </td>
                                        </tr>
                                        </tfoot>
                                    {% endif %}
                                </table>
                                {% if item.attachments is not empty %}
                                    {{ form_end(deleteForm) }}
                                {% endif %}
                            </div>
                            <div class="col-md-12">
                                <label>{{ _('Attach new files') }}</label><br/>
                                {% include('IServExerciseBundle:Form:uploadForm.html.twig') %}
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('components/x-editable/dist/bootstrap3-editable/css/bootstrap-editable.css') }}"/>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('components/x-editable/dist/bootstrap3-editable/js/bootstrap-editable.min.js') }}"></script>
    {% javascripts '@IServExerciseBundle/Resources/public/js/exercise.js' filter='?uglifyjs2' output='js/compiled/exercise.js' %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}
